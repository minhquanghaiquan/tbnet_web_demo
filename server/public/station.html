<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="http://178.128.113.184:8081/public/" target="_parent" />
    <link rel="stylesheet" href="style/station.css" />
    <link rel="shortcut icon" href="img/logo-web.png" />
    <title>TB NET - Station</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  </head>
  <body>
    <div class="header-table">
      <h1 id="device_id"></h1>
      <div class="button-logout">
        <button class="custom-button-fill" id="logoutButton">
          <span class="button-fill-text">Logout</span>
        </button>
      </div>
    </div>
    <p id="server_time"></p>
    <table id="customers">
      <tr>
        <th>Thông số</th>
        <th id="value000">Giá trị</th>
      </tr>
      <tr>
        <td>Điện áp Gen0</td>
        <td id="value0"></td>
      </tr>
      <tr>
        <td>Điện áp Gen1</td>
        <td id="value1"></td>
      </tr>
      <tr>
        <td>Điện áp Gen2</td>
        <td id="value2"></td>
      </tr>
      <tr>
        <td>Điện áp Gen3</td>
        <td id="value3"></td>
      </tr>
      <tr>
        <td>Điện áp Gen4</td>
        <td id="value4"></td>
      </tr>
      <tr>
        <td>Điện áp Gen5</td>
        <td id="value5"></td>
      </tr>
      <tr>
        <td>Điện áp Gen6</td>
        <td id="value6"></td>
      </tr>
      <tr>
        <td>Điện áp Gen7</td>
        <td id="value7"></td>
      </tr>
      <tr>
        <td>Điện áp Gen8</td>
        <td id="value8"></td>
      </tr>
      <tr>
        <td>Điện áp Gen9</td>
        <td id="value9"></td>
      </tr>
      <tr>
        <td>Điện áp Gen10</td>
        <td id="value10"></td>
      </tr>
      <tr>
        <td>Điện áp Gen11</td>
        <td id="value11"></td>
      </tr>
      <tr>
        <td>Điện áp Gen12</td>
        <td id="value12"></td>
      </tr>
      <tr>
        <td>Điện áp Gen13</td>
        <td id="value13"></td>
      </tr>
      <tr>
        <td>Điện áp Gen14</td>
        <td id="value14"></td>
      </tr>
      <tr>
        <td>Điện áp Gen15</td>
        <td id="value15"></td>
      </tr>
      <tr>
        <td>Điện áp Gen16</td>
        <td id="value16"></td>
      </tr>
      <tr>
        <td>Điện áp Gen17</td>
        <td id="value17"></td>
      </tr>
      <tr>
        <td>Điện áp Gen18</td>
        <td id="value18"></td>
      </tr>
      <tr>
        <td>Điện áp Gen19</td>
        <td id="value19"></td>
      </tr>
      <tr>
        <td>Điện áp Gen20</td>
        <td id="value20"></td>
      </tr>
      <tr>
        <td>Điện áp Gen21</td>
        <td id="value21"></td>
      </tr>
      <tr>
        <td>Điện áp Gen22</td>
        <td id="value22"></td>
      </tr>
      <tr>
        <td>Điện áp Gen23</td>
        <td id="value23"></td>
      </tr>
      <tr>
        <td>Điện áp Gen24</td>
        <td id="value24"></td>
      </tr>
      <tr>
        <td>Điện áp Gen25</td>
        <td id="value25"></td>
      </tr>
      <tr>
        <td>Điện áp Gen26</td>
        <td id="value26"></td>
      </tr>
      <tr>
        <td>Điện áp Gen27</td>
        <td id="value27"></td>
      </tr>
      <tr>
        <td>Điện áp Gen28</td>
        <td id="value28"></td>
      </tr>
      <tr>
        <td>Điện áp Gen29</td>
        <td id="value29"></td>
      </tr>
      <tr>
        <td>Điện áp Gen30</td>
        <td id="value30"></td>
      </tr>
      <tr>
        <td>Điện áp Gen31</td>
        <td id="value31"></td>
      </tr>
      <tr>
        <td>Điện áp Gen32</td>
        <td id="value32"></td>
      </tr>
      <tr>
        <td>Điện áp Gen33</td>
        <td id="value33"></td>
      </tr>
      <tr>
        <td>Điện áp Gen34</td>
        <td id="value34"></td>
      </tr>
      <tr>
        <td>Điện áp Gen35</td>
        <td id="value35"></td>
      </tr>
      <tr>
        <td>Điện áp Gen36</td>
        <td id="value36"></td>
      </tr>
      <tr>
        <td>Điện áp Gen37</td>
        <td id="value37"></td>
      </tr>
      <tr>
        <td>Điện áp Gen38</td>
        <td id="value38"></td>
      </tr>
      <tr>
        <td>Điện áp Gen39</td>
        <td id="value39"></td>
      </tr>
      <tr>
        <td>Điện áp Gen40</td>
        <td id="value40"></td>
      </tr>
      <tr>
        <td>Điện áp Gen41</td>
        <td id="value41"></td>
      </tr>
      <tr>
        <td>Điện áp Gen42</td>
        <td id="value42"></td>
      </tr>
      <tr>
        <td>Điện áp Gen43</td>
        <td id="value43"></td>
      </tr>
      <tr>
        <td>Điện áp Gen44</td>
        <td id="value44"></td>
      </tr>
      <tr>
        <td>Điện áp Gen45</td>
        <td id="value45"></td>
      </tr>
      <tr>
        <td>Điện áp Gen46</td>
        <td id="value46"></td>
      </tr>
      <tr>
        <td>Điện áp Gen47</td>
        <td id="value47"></td>
      </tr>
      <tr>
        <td>Điện áp Gen48</td>
        <td id="value48"></td>
      </tr>
      <tr>
        <td>Điện áp Gen49</td>
        <td id="value49"></td>
      </tr>
      <tr>
        <td>Điện áp Gen50</td>
        <td id="value50"></td>
      </tr>
      <tr>
        <td>Điện áp Gen51</td>
        <td id="value51"></td>
      </tr>
      <tr>
        <td>Điện áp Gen52</td>
        <td id="value52"></td>
      </tr>
      <tr>
        <td>Điện áp Gen53</td>
        <td id="value53"></td>
      </tr>
      <tr>
        <td>Điện áp Gen54</td>
        <td id="value54"></td>
      </tr>
      <tr>
        <td>Điện áp Gen55</td>
        <td id="value55"></td>
      </tr>
      <tr>
        <td>Điện áp Gen56</td>
        <td id="value56"></td>
      </tr>
      <tr>
        <td>Điện áp Gen57</td>
        <td id="value57"></td>
      </tr>
      <tr>
        <td>Điện áp Gen58</td>
        <td id="value58"></td>
      </tr>
      <tr>
        <td>Điện áp Gen59</td>
        <td id="value59"></td>
      </tr>
      <tr>
        <td>Điện áp Gen60</td>
        <td id="value60"></td>
      </tr>
      <tr>
        <td>Điện áp Gen61</td>
        <td id="value61"></td>
      </tr>
      <tr>
        <td>Điện áp Gen62</td>
        <td id="value62"></td>
      </tr>
      <tr>
        <td>Điện áp Gen63</td>
        <td id="value63"></td>
      </tr>
      <tr>
        <td>Điện áp Gen64</td>
        <td id="value64"></td>
      </tr>
      <tr>
        <td>Điện áp Gen65</td>
        <td id="value65"></td>
      </tr>
      <tr>
        <td>Điện áp Gen66</td>
        <td id="value66"></td>
      </tr>
      <tr>
        <td>Điện áp Gen67</td>
        <td id="value67"></td>
      </tr>
      <tr>
        <td>Điện áp Gen68</td>
        <td id="value68"></td>
      </tr>
      <tr>
        <td>Điện áp Gen69</td>
        <td id="value69"></td>
      </tr>
      <tr>
        <td>Điện áp Gen70</td>
        <td id="value70"></td>
      </tr>
      <tr>
        <td>Điện áp Gen71</td>
        <td id="value71"></td>
      </tr>
      <tr>
        <td>Điện áp Gen72</td>
        <td id="value72"></td>
      </tr>
      <tr>
        <td>Điện áp Gen73</td>
        <td id="value73"></td>
      </tr>
      <tr>
        <td>Điện áp Gen74</td>
        <td id="value74"></td>
      </tr>
      <tr>
        <td>Điện áp Gen75</td>
        <td id="value75"></td>
      </tr>
      <tr>
        <td>Điện áp Gen76</td>
        <td id="value76"></td>
      </tr>
      <tr>
        <td>Điện áp Gen77</td>
        <td id="value77"></td>
      </tr>
      <tr>
        <td>Điện áp Gen78</td>
        <td id="value78"></td>
      </tr>
      <tr>
        <td>Điện áp Gen79</td>
        <td id="value79"></td>
      </tr>
      <tr>
        <td>Điện áp Gen80</td>
        <td id="value80"></td>
      </tr>
      <tr>
        <td>Điện áp Gen81</td>
        <td id="value81"></td>
      </tr>
      <tr>
        <td>Điện áp Gen82</td>
        <td id="value82"></td>
      </tr>
      <tr>
        <td>Điện áp Gen83</td>
        <td id="value83"></td>
      </tr>
      <tr>
        <td>Điện áp Gen84</td>
        <td id="value84"></td>
      </tr>
      <tr>
        <td>Điện áp Gen85</td>
        <td id="value85"></td>
      </tr>
      <tr>
        <td>Điện áp Gen86</td>
        <td id="value86"></td>
      </tr>
      <tr>
        <td>Điện áp Gen87</td>
        <td id="value87"></td>
      </tr>
      <tr>
        <td>Điện áp Gen88</td>
        <td id="value88"></td>
      </tr>
      <tr>
        <td>Điện áp Gen89</td>
        <td id="value89"></td>
      </tr>
      <tr>
        <td>Điện áp Gen90</td>
        <td id="value90"></td>
      </tr>
      <tr>
        <td>Điện áp Gen91</td>
        <td id="value91"></td>
      </tr>
      <tr>
        <td>Điện áp Gen92</td>
        <td id="value92"></td>
      </tr>
      <tr>
        <td>Điện áp Gen93</td>
        <td id="value93"></td>
      </tr>
      <tr>
        <td>Điện áp Gen94</td>
        <td id="value94"></td>
      </tr>
      <tr>
        <td>Điện áp Gen95</td>
        <td id="value95"></td>
      </tr>
      <tr>
        <td>Điện áp Gen96</td>
        <td id="value96"></td>
      </tr>
      <tr>
        <td>Điện áp Gen97</td>
        <td id="value97"></td>
      </tr>
      <tr>
        <td>Điện áp Gen98</td>
        <td id="value98"></td>
      </tr>
      <tr>
        <td>Điện áp Gen99</td>
        <td id="value99"></td>
      </tr>
      <tr>
        <td>Điện áp Gen100</td>
        <td id="value100"></td>
      </tr>
      <tr>
        <td>Điện áp Gen101</td>
        <td id="value101"></td>
      </tr>
      <tr>
        <td>Điện áp Gen102</td>
        <td id="value102"></td>
      </tr>
      <tr>
        <td>Điện áp Gen103</td>
        <td id="value103"></td>
      </tr>
      <tr>
        <td>Điện áp Gen104</td>
        <td id="value104"></td>
      </tr>
      <tr>
        <td>Điện áp Gen105</td>
        <td id="value105"></td>
      </tr>
      <tr>
        <td>Điện áp Gen106</td>
        <td id="value106"></td>
      </tr>
      <tr>
        <td>Điện áp Gen107</td>
        <td id="value107"></td>
      </tr>
      <tr>
        <td>Điện áp Gen108</td>
        <td id="value108"></td>
      </tr>
      <tr>
        <td>Điện áp Gen109</td>
        <td id="value109"></td>
      </tr>
      <tr>
        <td>Điện áp Gen110</td>
        <td id="value110"></td>
      </tr>
      <tr>
        <td>Điện áp Gen111</td>
        <td id="value111"></td>
      </tr>
      <tr>
        <td>Điện áp Gen112</td>
        <td id="value112"></td>
      </tr>
      <tr>
        <td>Điện áp Gen113</td>
        <td id="value113"></td>
      </tr>
      <tr>
        <td>Điện áp Gen114</td>
        <td id="value114"></td>
      </tr>
      <tr>
        <td>Điện áp Gen115</td>
        <td id="value115"></td>
      </tr>
      <tr>
        <td>Điện áp Gen116</td>
        <td id="value116"></td>
      </tr>
      <tr>
        <td>Điện áp Gen117</td>
        <td id="value117"></td>
      </tr>
      <tr>
        <td>Điện áp Gen118</td>
        <td id="value118"></td>
      </tr>
      <tr>
        <td>Điện áp Gen119</td>
        <td id="value119"></td>
      </tr>
      <tr>
        <td>Điện áp Gen120</td>
        <td id="value120"></td>
      </tr>
    </table>
    <div class="div">
      <h1>Current Measurement Control</h1>
      <input
        type="checkbox"
        id="switch"
        class="checkbox"
        onclick="changeStatus();"
      />
      <label for="switch" class="toggle"> </label>
      <p id="status" style="font-size: 30"></p>
    </div>
    <script>
      let socket = io("http://178.128.113.184:8081");
      var device_id = localStorage.getItem("device_id");
      let status_currentcontrol = 0;

      //Socket server to client
      socket.on("time", (timeString) => {
        let el = document.getElementById("server_time");
        el.innerHTML = "Server time " + timeString;
      });
      socket.on(device_id + "/control", (newValue) => {
        handleData(newValue.payload);
      });

      //Get data for the first load
      getData = async () => {
        axios
          .get("http://178.128.113.184:8081/stations/" + device_id, {
            headers: { "auth-token": localStorage.getItem("auth-token") },
          })
          .then((response) => {
            if (response.data === false) {
              window.location.href = "login.html";
            }
            let lastValue = response.data.lastValue;
            let status_currentcontrol = response.data.status_currentcontrol;
            let device_id = document.getElementById("device_id");
            device_id.innerHTML = localStorage.getItem("device_id");
            handleStatusControl(status_currentcontrol);
            handleData(lastValue);
          })
          .catch((error) => {
            if (error) {
              console.log(error);
            } else {
              console.log(error.message);
            }
          });
      };
      getData();

      //Handle Data
      handleData = (values) => {
        console.log(values);
        for (var i = 0; i < 121; i++) {
          let el = document.getElementById("value" + i);
          var key = "s" + i;
          if (!values[key]) {
            el.innerHTML = 0;
          } else {
            el.innerHTML = values[key];
          }
        }
      };

      //Hadle status control
      handleStatusControl = (statusControl) => {
        const checkbox = document.getElementById("switch");
        const status = document.getElementById("status");
        if (statusControl == 1) {
          status_currentcontrol = 1;
          checkbox.checked = true;
          status.innerText = "ON";
        } else if (statusControl == 0) {
          status_currentcontrol = 0;
          checkbox.checked = false;
          status.innerText = "OFF";
        }
      };

      //Change status current control
      changeStatus = async () => {
        const status = document.getElementById("status");
        if (status_currentcontrol == 1) {
          status_currentcontrol = 0;
          status.innerText = "OFF";
        } else {
          status_currentcontrol = 1;
          status.innerText = "ON";
        }
        var data = {
          device_id,
          status_currentcontrol,
        };
        console.log(data);
        socket.emit("CurrentControl", data);
      };

      //logout
      var logoutButton = document.getElementById("logoutButton");
      logoutButton.addEventListener("click", () => {
        localStorage.removeItem("auth-token");
        window.location.href = "index.html";
      });
    </script>
  </body>
</html>
