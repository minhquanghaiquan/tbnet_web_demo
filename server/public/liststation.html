<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="http://localhost:8080/public/" target="_parent" />
    <link rel="stylesheet" href="style/liststation.css" />
    <link rel="shortcut icon" href="img/logo-web.png" />
    <title>TB NET - List Station</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="header-table">
      <h1>Danh sách trạm</h1>
      <div class="button-logout">
        <button class="custom-button-fill" id="logoutButton">
          <span class="button-fill-text">Logout</span>
        </button>
      </div>
    </div>
    <table id="customers">
      <tr>
        <th>Trạm</th>
        <th>Mã trạm</th>
        <th>Địa chỉ</th>
      </tr>
    </table>
  </body>
  <script>
    //Get list stations from database - collection "listStations"
    getListStations = async () => {
      console.log("HTTP GET with Axios");
      axios
        .get("http://localhost:8080/stations", {
          headers: { "auth-token": localStorage.getItem("auth-token") },
        })
        .then((response) => {
          if (response.data === false) {
            window.location.href = "login.html";
          }
          let listStations = response.data;
          handleData(listStations);
        })
        .catch((error) => {
          if (error.response) {
            console.log(error.reponse.status);
          } else {
            console.log(error.message);
          }
        });
    };
    getListStations();

    //Handle Data
    handleData = async (listStations) => {
      listStations.forEach((station) => {
        let tableElement = document.getElementById("customers");
        console.log(station);
        let tr = document.createElement("TR");
        let td1 = document.createElement("TD");
        let a = document.createElement("A");
        a.href = "./station.html";
        a.textContent = station.station_name;
        a.addEventListener("click", function () {
          localStorage.setItem("station_id", station.station_id);
          localStorage.setItem("station_name", station.station_name);
        });
        td1.appendChild(a);
        let td2 = document.createElement("TD");
        let td3 = document.createElement("TD");
        td2.textContent = station.station_id;
        td3.textContent = station.station_address;
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        tableElement.appendChild(tr);
      });
    };

    //logout
    var logoutButton = document.getElementById("logoutButton");
    logoutButton.addEventListener("click", () => {
      localStorage.removeItem("auth-token");
      window.location.href = "index.html";
    });
  </script>
</html>
